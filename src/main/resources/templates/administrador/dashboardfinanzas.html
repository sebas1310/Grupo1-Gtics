<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">

<head th:insert="fragments/administrador/librerias.html :: cabecera (titulo = 'Dashboard Finanzas')">
</head>

<body>

<!-- ======= Header ======= -->
<header th:replace="fragments/administrador/header.html :: header(num_not = '3', num_form = '2 ', por_canc = '1',  nombre = ${session.usuario.nombres} + ' ' + ${session.usuario.apellidos} + ' ' + '(' + ${session.usuario.tipodeusuario.nombre.toUpperCase()} + ')', num_men = '2', sede = |${session.usuario.sede.nombre}|, id=${session.usuario.idusuario})">
</header>
<!-- End Header -->

<!-- ======= Sidebar ======= -->
<aside th:replace="fragments/administrador/aside.html :: sidebar (active = 'dashboard')">
</aside>
<!-- End Sidebar-->
<!--Modal Cerrar Sesion-->
<div th:replace="fragments/administrador/modalCerrarSesion.html::modal">

</div>
<!-- End Modal-->

<main id="main" class="main">

  <div class="pagetitle">
    <h1>Finanzas</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a th:href="@{'/administrador'}">Dashboard</a></li>
        <li class="breadcrumb-item active">Finanzas</li>
      </ol>
    </nav>
  </div><!-- End Page Title -->

  <section class="section">
    <div class="row">
      <div class="col-lg-20">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Gr치fico de Barras</h5>


            <!-- Column Chart -->
            <div id="columnChart"></div>

            <script>
              function renderColumnChart(ingresos, egresos, meses) {
                const ganancias = egresos.map((egreso, index) => ingresos[index] - egreso);

                new ApexCharts(document.querySelector("#columnChart"), {
                  series: [{
                    name: 'Ingresos',
                    data: ingresos
                  }, {
                    name: 'Egresos',
                    data: egresos
                  }, {
                    name: 'Ganancias',
                    data: ganancias
                  }],
                  chart: {
                    type: 'bar',
                    height: 350
                  },
                  plotOptions: {
                    bar: {
                      horizontal: false,
                      columnWidth: '55%',
                      endingShape: 'rounded'
                    },
                  },
                  dataLabels: {
                    enabled: false
                  },
                  stroke: {
                    show: true,
                    width: 2,
                    colors: ['transparent']
                  },
                  xaxis: {
                    categories: meses,
                  },
                  yaxis: {
                    title: {
                      text: 'S/. (soles)'
                    }
                  },
                  fill: {
                    opacity: 1
                  },
                  tooltip: {
                    y: {
                      formatter: function(val) {
                        return "S/." + val + " soles ";
                      }
                    }
                  }
                }).render();
              }

              document.addEventListener("DOMContentLoaded", () => {
                const ingresos = [];
                const egresos = [];
                const meses = [];

                // Obtener los valores de la tabla
                const dataRows = document.querySelectorAll('.data-row');
                dataRows.forEach(row => {
                  const mes = row.querySelector('td:nth-child(1)').innerText;
                  const ingreso = parseFloat(row.querySelector('td:nth-child(2)').innerText);
                  const egreso = parseFloat(row.querySelector('td:nth-child(3)').innerText);

                  meses.push(mes);
                  ingresos.push(ingreso);
                  egresos.push(egreso);
                });

                // Llamar a la funci칩n del gr치fico con los valores obtenidos
                renderColumnChart(ingresos, egresos, meses);
              });
            </script>

            <!-- End Column Chart -->

            <h5 class="card-title">Detalles del Gr치fico</h5>
            <!-- Table -->
            <table class="table table-borderless datatable">
              <thead>
              <tr>
                <th scope="col" class="text-center">Mes</th>
                <th scope="col" class="text-center">Ingresos</th>
                <th scope="col" class="text-center">Egresos</th>
              </tr>
              </thead>
              <tbody>
              <tr th:each="ingresosegresos, info: ${listaIngresosEgresos}" class="data-row">
                <td th:text="${T(com.example.proyectogticsgrupo1.translate.MonthTranslator).translateMonth(ingresosegresos.getnombre_mes())}" class="text-center"></td>
                <td th:text="${ingresosegresos.getpromedio_monto_paciente()}" class="text-center"></td>
                <td th:text="${ingresosegresos.getpromedio_monto_doctor()}" class="text-center"></td>
              </tr>
              </tbody>
            </table>
            <!-- End Table -->

            <!-- End Table -->


          </div>

        </div>
      </div>
    </div>
  </section>
</main><!-- End #main -->

<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

<!-- Vendor JS Files -->
<script th:src="@{/assets/vendor/apexcharts/apexcharts.min.js}"></script>
<script th:src="@{/assets/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/assets/vendor/chart.js/chart.min.js}"></script>
<script th:src="@{/assets/vendor/echarts/echarts.min.js}"></script>
<script th:src="@{/assets/vendor/quill/quill.min.js}"></script>
<script th:src="@{/assets/vendor/simple-datatables/simple-datatables.js}"></script>
<script th:src="@{/assets/vendor/tinymce/tinymce.min.js}"></script>
<script th:src="@{/assets/vendor/php-email-form/validate.js}"></script>

<!-- Template Main JS File -->
<script th:src="@{/assets/js/main.js}"></script>

</body>

</html>
