<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:insert="fragments/doctor/librerias.html :: cabecera (titulo = ' Cuestionario')">
</head>
<body>
<!-- ======= Header ======= -->
<header th:replace="fragments/doctor/header.html :: header(num_not = '3', num_form = '2 ', por_canc = '1',  nombre = |${doctor.usuario.nombres} ${doctor.usuario.apellidos}  (${doctor.usuario.tipodeusuario.nombre.toUpperCase()})|, num_men = '2')">
</header>
<!-- End Header -->

<!-- ======= Sidebar ======= -->
<aside th:replace="fragments/doctor/aside.html :: sidebar (active = 'pacientesAtendidos')">
</aside><!-- End Sidebar-->

<!--Modal Cerrar Sesion-->
<div th:replace="fragments/doctor/modalCerrarSesion.html::modal">

</div>
<!-- End Modal-->

<main id="main" class="main">

    <div class="pagetitle">
        <h1>Cuestionario</h1>
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item active">Cuestionarios</li>
            </ol>
        </nav>
    </div><!-- End Page Title -->

    <section class="section ">
        <div class="row">

            <!-- Right side columns -->
            <div class="col-lg">
                <!-- Bitacora -->
                <div class="card recent-sales overflow-auto">
                    <div class="card-body">
                        <h5 class="card-title" th:text="|Cuestionario Médico - ${doctor.getEspecialidad().getNombre()}|">Cuestionario Médico</h5>
                        <div th:id="contenedorcuestionario">
                        <input th:id="idcuestionariomodelo" th:value="${idcuestionario}" class="form-control" type="hidden">
                        <div class="row mb-3" th:each="pregunta,indice:${listapreguntascuestionario}">
                            <label class="card-title" th:text="|Pregunta ${indice.index+1}:|"></label>
                            <label for="nombre0" class="col-md-4 col-lg-3 col-form-label" th:text="${pregunta}"></label>
                            <input name="nombre" type="text" class="form-control" id="nombre0" th:value="${null}" disabled>
                        </div>
                            <input th:value="${paciente.getUsuario().getIdusuario()}" class="form-control" type="hidden">
                            <input th:value="${idcita}" class="form-control" type="hidden">
                            <button type="submit" class="btn btn-primary" onclick="ModificarForm()" >Enviar a Paciente</button>
                        </div>
                    </div>

                        <!--<h5 class="card-title">Datos del Paciente</h5>
                        <h6 class="card-title">Cita 1</h6>
                        <form method="post" th:action="@{'/doctor/enviocuestionario'}" class="row g-3">


                            <input th:value="${doctor.getEspecialidad().getIdespecialidad()}" name="idespecialidad" type="hidden" >

                            <input th:value="${paciente.getUsuario().getCorreo()}" name="correodestino" type="hidden" >

                            <div class="col-md-6">
                                <label for="nombre" class="form-label">Nombre del Paciente</label>
                                <input th:value="|${paciente.usuario.nombres} ${paciente.usuario.apellidos}|" type="text" class="form-control" id="nombre" disabled readonly >
                            </div>

                            <div class="col-md-6">
                                <label for="enfermedad" class="form-label">Condición o Enfermedad</label>
                                <input th:value="${paciente.getCondicionenfermedad()}" type="text" class="form-control" id="enfermedad"  disabled readonly>
                            </div>


                            <div class="col-md-6">
                                <label for="especialidad" class="form-label">Especialidad</label>
                                <input th:value="${doc.especialidad.nombre}" type="text" class="form-control" id="especialidad" disabled readonly>
                            </div>
                            <div class="col-md-6">
                                <label for="alergias" class="form-label">Alergias</label>
                                <input th:value="${paciente.getAlergias()}" type="text" class="form-control" id="alergias"  disabled readonly>
                            </div>

                            <div class="col-md-6">
                                <label for="ingresoplataforma" class="form-label">Apenas El Paciente Ingrese a la Plataforma</label>
                                <select class="form-select" id="ingresoplataforma" name="mostrar_automatico" required>
                                    <option selected disabled value="">Seleccione</option>
                                    <option th:value="1" th:text="Sí"></option>
                                    <option th:value="0" th:text="No"></option>
                                </select>
                            </div>

                            <div class="d-grid gap d-md-flex justify-content-md-center">
                                <button class="btn btn-primary" type="submit">Enviar Cuestionario</button>
                            </div>
                        </form>
                    </div> -->
                </div>
            </div>
        </div>
        </div>
    </section>
</main><!-- End #main -->

<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
<!-- Vendor JS Files -->
<script th:src="@{'/assets/vendor/apexcharts/apexcharts.min.js'}"></script>
<script th:src="@{'/assets/vendor/bootstrap/js/bootstrap.bundle.min.js'}"></script>
<script th:src="@{'/assets/vendor/chart.js/chart.min.js'}"></script>
<script th:src="@{'/assets/vendor/echarts/echarts.min.js'}"></script>
<script th:src="@{'/assets/vendor/quill/quill.min.js'}"></script>
<script th:src="@{'/assets/vendor/simple-datatables/simple-datatables.js'}"></script>
<script th:src="@{'/assets/vendor/tinymce/tinymce.min.js'}"></script>
<script th:src="@{'/assets/vendor/php-email-form/validate.js'}"></script>

<!-- Template Main JS File -->
<script th:src="@{'/assets/js/main.js'}"></script>

<script>
    function ModificarForm() {

//id modelo
        const id_de_modelo_plantilla_2 = document.getElementById("idcuestionariomodelo").value

        console.log(id_de_modelo_plantilla_2);


//id div - contenedor
        var inputs = document.getElementById("contenedorcuestionario").querySelectorAll("input.form-control");
        var valores = [];

//se agrega primero el id del informe
        valores.push(id_de_modelo_plantilla_2)

//y luego la lista de inputs llenos
        for (var i = 0; i < inputs.length; i++) {
            var valor = inputs[i].value;
            valores.push(valor);
        }



        console.log(valores);



// const crearModal = bootstrap.Modal.getOrCreateInstance('#createModal');
// crearModal.hide();


        var xmlhttp = new XMLHttpRequest();
        var url = "/doctor/cuestionario/enviarcuestionario?valores=" + encodeURIComponent(valores);
        xmlhttp.open("POST", url, true);
        xmlhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xmlhttp.onreadystatechange = function () {

            if (xmlhttp.readyState == XMLHttpRequest.DONE) {
                if (xmlhttp.status == 200) {
// Mostrar mensaje de éxito
                    alert("Datos Guardados");
                    location.reload();


                } else {
// Mostrar mensaje de error
                    alert("Ha ocurrido un error al llenar el informe");
                }
            }
        };

        xmlhttp.send();

// xmlhttp.send(datos);

    };
</script>

</body>


</html>
